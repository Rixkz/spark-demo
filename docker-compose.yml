version: "3"
services:
  spark:
    container_name: spark
    build:
      dockerfile: Dockerfile
      context: .
    external_links:
      - postgres:pgsql
    entrypoint: 
      - python3
      - -u
      - main.py
    networks: 
      - rabbitmq-network
    depends_on:
      rabbitmq:
        condition: service_healthy
      
  rabbitmq:
    image: rabbitmq:3.9-management
    container_name: rabbitmq
    ports: 
      - 5762:5672
      - 15672:15672
    networks:
      - rabbitmq-network
    healthcheck:
      test: rabbitmq-diagnostics -q ping
      interval: 15s
      timeout: 15s
      retries: 5

networks:
  rabbitmq-network:
    driver: bridge